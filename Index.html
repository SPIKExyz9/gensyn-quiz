/*
Gensyn-Quiz-App (Single-file React component)

Instructions (quick):
1) Create a new GitHub repo. 
2) Create a Vite React app (recommended) or Next.js app.
   - Vite: npm create vite@latest my-quiz -- --template react then cd my-quiz and install dependencies.
   - Next.js: npx create-next-app@latest my-quiz
3) Install Tailwind CSS (recommended). Follow Tailwind docs for Vite/Next.
4) Replace src/App.jsx (Vite) or create components/QuizApp.jsx (Next) with the component below.
5) Import and render the component in your main app (e.g., in App.jsx or pages/index.jsx).
6) Commit to GitHub and connect the repo to Vercel (import project, default build settings usually work).

This single-file component contains:
 - 25 MCQs about Gensyn/Swarm/Block Assist/Judge Game
 - Multiple-choice UI, progress, scoring, review mode
 - LocalStorage persistence (so a user can resume)
 - Shareable result link (copies score text to clipboard)

Feel free to request: add authentication, a backend to store high scores, timed quizzes, or question import CSV.
*/

import React, { useEffect, useState } from "react";

const QUESTIONS = [
  { id: 1, q: "What is Gensyn primarily focused on?", opts: ["Decentralized storage", "Decentralized AI compute marketplace", "Gaming NFTs", "Social media"], a: 1 },
  { id: 2, q: "Which resource is most important for running a Gensyn node?", opts: ["GPU", "RAM", "Bandwidth", "CPU"], a: 0 },
  { id: 3, q: "What does Gensyn aim to decentralize?", opts: ["Smart contracts", "AI model training", "NFT marketplaces", "Gaming tournaments"], a: 1 },
  { id: 4, q: "Running a Gensyn node mainly helps in:", opts: ["Mining Bitcoin", "Providing computing power", "Storing files", "Building websites"], a: 1 },
  { id: 5, q: "What type of AI tasks does Gensyn focus on?", opts: ["Image editing only", "Natural Language Processing & ML", "Web3 browsers", "Crypto staking"], a: 1 },
  { id: 6, q: "What is Swarm in Web3?", opts: ["Blockchain explorer", "Decentralized storage & communication system", "NFT exchange", "Crypto wallet"], a: 1 },
  { id: 7, q: "Which blockchain is Swarm originally connected to?", opts: ["Solana", "Ethereum", "Avalanche", "Polkadot"], a: 1 },
  { id: 8, q: "What token powers the Swarm network?", opts: ["BZZ", "ETH", "BTC", "SOL"], a: 0 },
  { id: 9, q: "What is a Swarm Bee Node?", opts: ["A mining machine", "A node storing and sharing data", "A governance contract", "An oracle service"], a: 1 },
  { id: 10, q: "What is the Block Assist project mainly for?", opts: ["DeFi lending", "Educational & technical support hub for blockchain", "NFT minting", "Gaming"], a: 1 },
  { id: 11, q: "Block Assist mostly focuses on:", opts: ["Assisting node runners & builders", "Staking ETH", "Selling NFTs", "Running AI compute"], a: 0 },
  { id: 12, q: "Block Assist provides guides mainly for:", opts: ["Social media apps", "Node setups", "Video editing", "Crypto gaming"], a: 1 },
  { id: 13, q: "What is the Judge Game used for?", opts: ["A governance & evaluation game", "A blockchain explorer", "A staking pool", "A storage tool"], a: 0 },
  { id: 14, q: "Participants in Judge Game are usually called:", opts: ["Miners", "Judges", "Players", "Validators"], a: 1 },
  { id: 15, q: "Judge Game helps to:", opts: ["Evaluate project fairness", "Send transactions", "Train AI", "Mine Bitcoin"], a: 0 },
  { id: 16, q: "What skill is most useful in Judge Game?", opts: ["Decision-making", "GPU power", "File storage", "Trading"], a: 0 },
  { id: 17, q: "Which best describes Judge Game's purpose?", opts: ["Decentralized decision-making", "AI model training", "Crypto trading", "File sharing"], a: 0 },
  { id: 18, q: "What is required to earn rewards in Gensyn?", opts: ["Providing AI compute", "Posting on Twitter", "Writing smart contracts", "Sending transactions"], a: 0 },

{ id: 19, q: "Which feature makes Swarm unique?", opts: ["Off-chain communication", "Proof of Work mining", "Layer 2 scaling", "GPU validation"], a: 0 },
  { id: 20, q: "The main goal of Swarm is:", opts: ["Trading NFTs", "Secure decentralized file storage", "Mining Bitcoin", "Running AI tasks"], a: 1 },
  { id: 21, q: "The main outcome of Judge Game is:", opts: ["Fair evaluation", "Token burning", "Smart contract deployment", "Data storage"], a: 0 },
  { id: 22, q: "Which group benefits most from Block Assist?", opts: ["Developers & validators", "Traders only", "Gamers", "Musicians"], a: 0 },
  { id: 23, q: "What is a primary metric in quizzes for users?", opts: ["Proof of Work", "Score percentage", "Number of GPUs", "Transaction fees"], a: 1 },
  { id: 24, q: "How many options should each question have in this quiz?", opts: ["2", "3", "4", "5"], a: 2 },
  { id: 25, q: "What should you do after deploying to Vercel?", opts: ["Delete the repo", "Share the site link", "Uninstall Tailwind", "Disable CI"], a: 1 }
];

const STORAGE_KEY = "gensyn_quiz_state_v1";

export default function QuizApp() {
  const [index, setIndex] = useState(0);
  const [answers, setAnswers] = useState(() => Array(QUESTIONS.length).fill(null));
  const [showScore, setShowScore] = useState(false);
  const [reviewMode, setReviewMode] = useState(false);
  const [seed, setSeed] = useState(0); // can be used to randomize later

  useEffect(() => {
    // load from localStorage
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (parsed.answers) setAnswers(parsed.answers);
        if (typeof parsed.index === "number") setIndex(parsed.index);
        if (parsed.showScore) setShowScore(parsed.showScore);
      }
    } catch (e) {
      console.warn("Could not load quiz state:", e);
    }
  }, []);

  useEffect(() => {
    // persist
    const payload = { answers, index, showScore };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  }, [answers, index, showScore]);

  const choose = (qidx, optIdx) => {
    if (reviewMode) return;
    const next = [...answers];
    next[qidx] = optIdx;
    setAnswers(next);
  };

  const goNext = () => {
    if (index < QUESTIONS.length - 1) setIndex(index + 1);
    else finish();
  };

  const goPrev = () => {
    if (index > 0) setIndex(index - 1);
  };

  const finish = () => {
    setShowScore(true);
    setReviewMode(true);
  };

  const restart = () => {
    setAnswers(Array(QUESTIONS.length).fill(null));
    setIndex(0);
    setShowScore(false);
    setReviewMode(false);
    localStorage.removeItem(STORAGE_KEY);
  };

  const score = QUESTIONS.reduce((acc, q, i) => (answers[i] === q.a ? acc + 1 : acc), 0);
  const percent = Math.round((score / QUESTIONS.length) * 100);

  const copyResult = async () => {
    const text = I scored ${score}/${QUESTIONS.length} (${percent}%) on the Gensyn quiz!;
    try {
      await navigator.clipboard.writeText(text);
      alert("Result copied to clipboard: " + text);
    } catch (e) {
      alert(text);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-100 to-white flex items-center justify-center p-6">
      <div className="max-w-3xl w-full bg-white rounded-2xl shadow-lg p-6 md:p-10">
        <header className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold">Gensyn & Web3 Quiz</h1>
            <p className="text-sm text-slate-500">25 questions • 4 options each • Built for GitHub + Vercel</p>
          </div>
          <div className="text-right">
            <div className="text-sm text-slate-600">Question</div>
            <div className="font-medium text-lg">{index + 1} / {QUESTIONS.length}</div>
          </div>
        </header>

{!showScore ? (
          <main>
            <section className="mb-4">
              <h2 className="text-lg font-semibold">{QUESTIONS[index].q}</h2>
              <p className="text-sm text-slate-500 mt-1">Select one answer below.</p>
            </section>

            <section className="grid gap-3">
              {QUESTIONS[index].opts.map((opt, oi) => {
                const chosen = answers[index] === oi;
                const correct = QUESTIONS[index].a === oi;
                const showCorrect = reviewMode && correct;
                return (
                  <button
                    key={oi}
                    onClick={() => choose(index, oi)}
                    className={text-left p-3 rounded-xl border transition-shadow flex items-center justify-between ${chosen ? "bg-slate-800 text-white border-transparent shadow" : "bg-white"} ${showCorrect ? "ring-2 ring-emerald-300" : "hover:shadow-md"}}
                  >
                    <div>
                      <div className="text-sm font-medium">{String.fromCharCode(65 + oi)}. {opt}</div>
                    </div>
                    <div className="text-xs text-slate-400">{chosen ? "Selected" : ""}</div>
                  </button>
                );
              })}
            </section>

            <footer className="mt-6 flex items-center justify-between">
              <div className="flex gap-2">
                <button onClick={goPrev} disabled={index === 0} className="px-3 py-2 rounded-lg border disabled:opacity-40">Previous</button>
                <button onClick={goNext} className="px-4 py-2 rounded-lg bg-slate-800 text-white">{index === QUESTIONS.length - 1 ? "Finish" : "Next"}</button>
              </div>

              <div className="text-sm text-slate-500">Answered: {answers.filter(a => a !== null).length} / {QUESTIONS.length}</div>
            </footer>
          </main>
        ) : (
          <main>
            <div className="text-center py-6">
              <h2 className="text-2xl font-bold">Your Score</h2>
              <div className="mt-4 text-4xl font-extrabold">{score} / {QUESTIONS.length}</div>
              <div className="mt-2 text-sm text-slate-500">{percent}%</div>

              <div className="mt-6 flex flex-wrap gap-3 justify-center">
                <button onClick={() => setReviewMode(!reviewMode)} className="px-4 py-2 rounded-lg border">{reviewMode ? "Hide Review" : "Review Answers"}</button>
                <button onClick={copyResult} className="px-4 py-2 rounded-lg bg-teal-600 text-white">Copy Result</button>
                <button onClick={restart} className="px-4 py-2 rounded-lg border">Retry</button>
              </div>

              <div className="mt-8 text-left">
                <h3 className="font-semibold mb-2">Summary</h3>
                <ul className="space-y-2">
                  {QUESTIONS.map((q, i) => {
                    const user = answers[i];
                    const correct = q.a;
                    const ok = user === correct;
                    return (
                      <li key={q.id} className="p-3 rounded-lg border bg-slate-50">
                        <div className="flex justify-between items-start">
                          <div>
                            <div className="text-sm font-medium">{i + 1}. {q.q}</div>
                            <div className="text-xs text-slate-600 mt-1">Your answer: {user === null ? <em>Not answered</em> : ${String.fromCharCode(65 + user)}. ${q.opts[user]}}</div>
                            <div className="text-xs text-slate-600">Correct: {String.fromCharCode(65 + correct)}. {q.opts[correct]}</div>
                          </div>
                          <div className={font-semibold ${ok ? "text-emerald-600" : "text-rose-600"}}>{ok ? "Correct" : "Wrong"}</div>
                        </div>
                      </li>
                    );
                  })}
                </ul>
              </div>
            </div>
          </main>
        )}

<aside className="mt-6 text-xs text-slate-400">This is a client-side demo. To make a production quiz: add server storage for results, authentication, and content management.</aside>
      </div>
    </div>
  );
}
